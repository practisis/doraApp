function objetoAjax(){var e=!1;try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){e=!1}}return e||"undefined"==typeof XMLHttpRequest||(e=new XMLHttpRequest),e}function quebloque(e){console.log(e),1==e?(document.getElementById("retencion").style.display="none",$("#productos").fadeIn("slow"),$("#poprelacionados").css("display","none")):2==e&&($("#productos").fadeOut("fast"),$("#retencion").fadeIn("slow"),$("#poprelacionados").css("display","none"))}function retiva(){var e=document.getElementById("retencioniva").value.split("||");document.getElementById("porcretiva").value=e[1]}function ret(){var e=document.getElementById("reten").value.split("||");document.getElementById("porcret").value=e[1]}function agregaretiva(e){for(var t=document.getElementById("numretencion").value,a=document.getElementById("retencioniva").value,n=a.split("||"),o=document.getElementById("baseretiva").value,l=parseFloat(document.getElementById("baseretiva").value),r=parseFloat(document.getElementById("baseretivareal").value),d=0,i=0,s=parseFloat(n[1]),u=document.getElementById("detalleretenciones").getElementsByTagName("input"),c=0;c<u.length;c++){var m=u[c].id;if("idret"==m.substr(0,5)){e=m.substr(5);var v=document.getElementById("idret"+e).value;if(n[0]==v)return alert("No puede ingresar una misma retención."),!1}}0==e&&(r=l),""==t?alert("Debe ingresar el numero de la retención."):1==e&&l>r&&(alert("Debe ingresar una base imponible para la retención de : "+r),document.getElementById("baseretiva").value=r),"0"!=a&&"0"!=o&&""!=o&&l>0&&(d=l*(s/100),(i=r-l)<0&&(i=0),document.getElementById("baseretiva").value=i.toFixed(4),document.getElementById("baseretivareal").value=i.toFixed(4),contm=1e4+n[0],document.getElementById("cuenta").value=contm,myNewRow=document.getElementById("detalleretenciones").insertRow(-1),myNewRow.id="r_"+contm,myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="nombreret'+contm+'" id="nombreret'+contm+'" class="form-control" style="width: 100%;height:25px;" value="'+n[2]+'" readonly="readonly"/><input type="hidden" name="idret'+contm+'" id="idret'+contm+'" value="'+n[0]+'"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="porcentajeret'+contm+'" id="porcentajeret'+contm+'" class="form-control" style="width: 100%;text-align: right;height:25px;" value="'+n[1]+'" readonly="readonly"/><input type="hidden" name="aux'+contm+'" id="aux'+contm+'" value="1"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="baseret'+contm+'" id="baseret'+contm+'" class="form-control" style="width: 100%;text-align: right;height:25px;" value="'+l+'" readonly="readonly"/><input type="hidden" name="baseciva'+contm+'" id="baseciva'+contm+'" value="'+l+'"/><input type="hidden" name="basesiva'+contm+'" id="basesiva'+contm+'" value="0"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="valorret'+contm+'" id="valorret'+contm+'" class="form-control" style="width: 100%;text-align: right;height:25px;" value="'+(Math.round(100*d)/100).toFixed(2)+'" readonly="readonly"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><button type="button" onclick="RemoveRowIva('+contm+');" class="removeLine form-control input-sm fa fa-times"></button></td>'),sacatotal()}function RemoveRowIva(e){var t=0;t=parseFloat(document.getElementById("baseret"+e).value)+parseFloat(document.getElementById("baseretivareal").value),document.getElementById("baseretivareal").value=t,document.getElementById("baseretiva").value=t;var a=document.getElementById("r_"+e);a.parentNode.removeChild(a),sacatotal()}function agregaret(e){var t=document.getElementById("numretencion").value,a=document.getElementById("reten").value,n=a.split("||"),o=document.getElementById("baseretsubciva").value,l=parseFloat(document.getElementById("baseretsubciva").value),r=parseFloat(document.getElementById("baseretsubcivareal").value),d=document.getElementById("baseretsubsiva").value,i=parseFloat(document.getElementById("baseretsubsiva").value),s=parseFloat(document.getElementById("baseretsubsivareal").value),u=0,c=0,m=parseFloat(n[1]),v=document.getElementById("detalleretenciones").getElementsByTagName("input");console.log(v);for(var p=0;p<v.length;p++){var g=v[p].id;if("idret"==g.substr(0,5)){var b=g.substr(5),y=document.getElementById("idret"+b).value;if(n[0]==y)return alert("No puede ingresar una misma retención."),!1}}var I=!0;""==t?alert("Debe ingresar el numero de la retención."):1==e&&(l>r?(alert("Debe ingresar una base imponible c/iva para la retención de : "+r),document.getElementById("baseretsubciva").value=r,I=!1):i>s&&(alert("Debe ingresar una base imponible s/iva para la retención de : "+s),document.getElementById("baseretsubsiva").value=s,I=!1)),1==I&&("0"==a||"0"==o&&"0"==d||""==o&&""==d||(u=(l+i)*(m/100),1==e?(r>0||s>0)&&(basequedaci=r-l,basequedasi=s-i,document.getElementById("baseretsubciva").value=basequedaci.toFixed(4),document.getElementById("baseretsubcivareal").value=basequedaci.toFixed(4),document.getElementById("baseretsubsiva").value=basequedasi.toFixed(4),document.getElementById("baseretsubsivareal").value=basequedasi.toFixed(4)):(basequedaci=0,basequedasi=0,(r>0||s>0)&&(document.getElementById("baseretsubciva").value=basequedaci.toFixed(4),document.getElementById("baseretsubcivareal").value=basequedaci.toFixed(4),document.getElementById("baseretsubsiva").value=basequedasi.toFixed(4),document.getElementById("baseretsubsivareal").value=basequedasi.toFixed(4))),c=l+i,contm=1e4+n[0],document.getElementById("cuenta").value=contm,myNewRow=document.getElementById("detalleretenciones").insertRow(-1),myNewRow.id="r_"+contm,myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="nombreret'+contm+'" id="nombreret'+contm+'" class="form-control input-sm" style="width: 100%;height:25px;" value="'+n[2]+'" readonly="readonly"/><input type="hidden" name="idret'+contm+'" id="idret'+contm+'" value="'+n[0]+'"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="porcentajeret'+contm+'" id="porcentajeret'+contm+'" class="form-control input-sm" style="width: 100%;text-align: right;height:25px;" value="'+n[1]+'" readonly="readonly"/><input type="hidden" name="aux'+contm+'" id="aux'+contm+'" value="2"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="baseret'+contm+'" id="baseret'+contm+'" class="form-control input-sm" style="width: 100%;text-align: right;height:25px;" value="'+c+'" readonly="readonly"/><input type="hidden" name="baseciva'+contm+'" id="baseciva'+contm+'" value="'+l+'"/><input type="hidden" name="basesiva'+contm+'" id="basesiva'+contm+'" value="'+i+'"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="valorret'+contm+'" id="valorret'+contm+'" class="form-control input-sm" style="width: 100%;text-align: right;height:25px;" value="'+(Math.round(100*u)/100).toFixed(2)+'" readonly="readonly"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><button type="button" onclick="RemoveRow('+contm+');" class="removeLine form-control input-sm fa fa-times"></button></td>')),sacatotal()}function RemoveRow(e){var t=0,a=0;t=parseFloat(document.getElementById("baseciva"+e).value)+parseFloat(document.getElementById("baseretsubcivareal").value),a=parseFloat(document.getElementById("basesiva"+e).value)+parseFloat(document.getElementById("baseretsubsivareal").value),document.getElementById("baseretsubcivareal").value=t,document.getElementById("baseretsubciva").value=t,document.getElementById("baseretsubsivareal").value=a,document.getElementById("baseretsubsiva").value=a;var n=$("#r_"+e);console.log(n),n.remove(),sacatotal()}function sacatotal(){for(var e=document.getElementById("detalleretenciones").getElementsByTagName("input"),t=0,a=0,n=0;n<e.length;n++){var o=e[n].id;if("valorret"==o.substr(0,8)){var l=o.substr(8);t+=parseFloat(document.getElementById("valorret"+l).value)}}document.getElementById("totalretencion").value=t.toFixed(2);var r=parseFloat($("#totaltotal").val());a=r-t,console.log(r+"**"+t+"**"+a+"suma1"),$("#totaldebe").val(a.toFixed(2))}function validarretencion(){$(".alert-danger").not("#uploaderrors").fadeOut("slow");for(var e="",t="",a=document.getElementById("detalleretenciones").getElementsByTagName("input"),n=0,o=0;o<a.length;o++){var l=a[o].id;if("idret"==l.substr(0,5)){var r=l.substr(5),d=parseFloat(document.getElementById("aux"+r).value);t+=parseFloat(document.getElementById("idret"+r).value)+"||"+document.getElementById("nombreret"+r).value+"||"+parseFloat(document.getElementById("porcentajeret"+r).value)+"||"+parseFloat(document.getElementById("baseciva"+r).value)+"||"+parseFloat(document.getElementById("basesiva"+r).value)+"||"+d+"@@",n+=1}}if(n>0){var i=document.getElementById("numretencion").value,s=document.getElementById("ingresoret").value,u=document.getElementById("sriret").value,c=document.getElementById("serieret").value,m=document.getElementById("caducaret").value;e=i+"||"+c+"||"+u+"||"+s+"||"+m+"||"+parseFloat(document.getElementById("totalretencion").value),""==i?($("#error-content").html("Debe ingresar el numero de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0)):""==s?($("#error-content").html("Debe ingresar la fecha de ingreso de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0)):""==u?($("#error-content").html("Debe ingresar el numero de autorización de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0)):""==c?($("#error-content").html("Debe ingresar el numero de serie de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0)):""==m?($("#error-content").html("Debe ingresar la fecha de caducidad de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0)):(document.getElementById("datosretencion").value=e,document.getElementById("datosdetalleretencion").value=t,document.getElementById("tieneretencion").value=1,continua_egreso())}else document.getElementById("datosretencion").value="",document.getElementById("datosdetalleretencion").value="",document.getElementById("tieneretencion").value=0,continua_egreso(),console.log("DSD2")}function verbases(e,t,a){var n=parseFloat(document.getElementById("baseretiva").value),o=parseFloat(document.getElementById("baseretsubciva").value),l=parseFloat(document.getElementById("baseretsubsiva").value);n-=e,o-=t,l-=a,document.getElementById("baseretiva").value=n.toFixed(4),document.getElementById("baseretivareal").value=n.toFixed(4),document.getElementById("baseretsubciva").value=o.toFixed(4),document.getElementById("baseretsubcivareal").value=o.toFixed(4),document.getElementById("baseretsubsiva").value=l.toFixed(4),document.getElementById("baseretsubsivareal").value=l.toFixed(4)}function guardaret(e,t){$(".alert-danger").not("#uploaderrors").fadeOut("slow");for(var a="",n="",o=document.getElementById("detalleretenciones").getElementsByTagName("input"),l=0,r=0;r<o.length;r++){var d=o[r].id;if("idret"==d.substr(0,5)){var i=d.substr(5),s=parseFloat(document.getElementById("aux"+i).value);n+=parseFloat(document.getElementById("idret"+i).value)+"||"+document.getElementById("nombreret"+i).value+"||"+parseFloat(document.getElementById("porcentajeret"+i).value)+"||"+parseFloat(document.getElementById("baseciva"+i).value)+"||"+parseFloat(document.getElementById("basesiva"+i).value)+"||"+s+"@@",l+=1}}if(l>0){var u=document.getElementById("numretencion").value,c=document.getElementById("ingresoret").value,m=document.getElementById("sriret").value,v=document.getElementById("serieret").value,p=document.getElementById("caducaret").value;if(a=u+"||"+v+"||"+m+"||"+c+"||"+p+"||"+parseFloat(document.getElementById("totalretencion").value)+"||"+parseFloat(document.getElementById("idasiento").value),""==u)$("#error-content").html("Debe ingresar el numero de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0);else if(""==c)$("#error-content").html("Debe ingresar la fecha de ingreso de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0);else if(""==p)$("#error-content").html("Debe ingresar la fecha de caducidad de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0);else{document.getElementById("datosretencion").value=a,document.getElementById("datosdetalleretencion").value=n,document.getElementById("tieneretencion").value=1;var g=objetoAjax();g.open("POST","/contabilidad/ajax/retenciones.php",!0),g.onreadystatechange=function(){if(4==g.readyState){var e=g.responseText;console.log(e),location.reload(!0)}},g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.send("&datosretencion="+a+"&datosdetalleretencion="+n+"&id="+e+"&idcli="+t+"&tieneretencion=1&que=1")}}}function CalcularSublinea(e){var t=$(e).attr("id").split("_"),a=parseFloat(document.getElementById("ivaaux").value);if(1==$("#multiple_iva").val()){var n=$("#prodImpg_"+t[1]),o=$(n).find("option:selected");a=parseFloat(o.attr("data-value")),$("#prodIDImpg_"+t[1]).val(a)}var l=0;$(".subconiva").each(function(){l+=parseFloat($(this).val())});var r=0;$(".subsiniva").each(function(){r+=parseFloat($(this).val())});var d=0;d=(l-=parseFloat($("#secondDiscount").val()))*a;var i=0;0==$("#multiple_iva").val()?$(".subceroiva").each(function(){i+=parseFloat($(this).val())}):$(".prodImpg").each(function(){var e=$(this).find("option:selected"),t=parseFloat(e.attr("data-value")),a=$(this).attr("id").split("_");0==t&$(this).val()>0&&(i+=parseFloat($("#subciva_"+a[1]).val()))}),i>0&&1==$("#multiple_iva").val()&&(l=0);var s=0;$(".subceroiva").length>0&&(s=parseFloat($("#subceroiva_"+t[1]).val()));var u=parseFloat($("#subsiva_"+t[1]).val())+parseFloat($("#subciva_"+t[1]).val())*(1+a)+s;console.log(u),$("#total_"+t[1]).val(u.toFixed(2)),$("#firstSubConIva").val(l.toFixed(4)),$("#firstSubSinIva").val(r.toFixed(4)),$("#firstSubCeroIva").val(i.toFixed(4)),$("#finalIVA").val(d.toFixed(4)),CalculateCosts($("#firstDiscount")),CalculateCosts($("#secondDiscount")),CalculateCosts($("#firstDiscountCero")),MisTotales()}function AddLineGasto(){for(var e=$("#tablegastos tr"),t=1,a=0;a<e.length;a++){var n=e[a].id.split("_")[1];parseInt(n)>t&&(t=parseInt(n))}var o=parseInt(t)+1,l=$(".origLineg").clone().find("input").val("0.00").end().insertAfter("#tablegastos tr:last");l.removeAttr("class"),l.attr("id","fila_"+o),l.find(".cuentas").attr("id","cuenta_"+o),l.find(".idcuentas").attr("id","idcuenta_"+o),$("#cuenta_"+o+",#idcuenta_"+o).val(""),l.find(".subconiva").attr("id","subciva_"+o),l.find(".subsiniva").attr("id","subsiva_"+o),l.find(".subceroiva").attr("id","subceroiva_"+o),l.find(".totales").attr("id","total_"+o),l.find(".eliminargasto").attr("id","eliminar_"+o),l.find(".selcentroc").attr("id","centrocosto_"+o),l.find(".prodIDImpg").attr("id","prodIDImpg_"+o),l.find(".prodImpg").attr("id","prodImpg_"+o),$("#centrocosto_"+o).val($("#centrocosto_1").val()),LigarAutocomplete()}function LigarAutocomplete(){$(".cuentas").each(function(){$(this).autocomplete({source:"subpages/contabilidad/ajaxplannew.php",select:function(e,t){console.log(t.item.id);var a=$(this).attr("id").split("_");$("#idcuenta_"+a[1]).val(t.item.id),$("#subciva_"+a[1]).focus(),$("#subciva_"+a[1]).select()}})})}function MisTotales(){var e=parseFloat($("#firstSubSinIva").val()),t=parseFloat($("#firstDiscount").val()),a=parseFloat($("#secondDiscount").val()),n=parseFloat($("#firstSubConIva").val()),o=parseFloat($("#firstSubCeroIva").val()),l=parseFloat($("#firstDiscountCero").val()),r=parseFloat($("#ice").val()),d=parseFloat($("#impVerde").val()),i=parseFloat($("#finalIVA").val()),s=""==$("#otros").val()?0:parseFloat($("#otros").val());console.log(r),console.log(n-a+"entra 0"),$("#finalTotal").html(parseFloat(n-a+(e-t)+parseFloat(o-l)+i+r+d+s).toFixed(2))}function EliminarFilaGasto(e){var t=$(e).attr("id").split("_"),a=$("#fila_"+t[1]);parseInt(t[1])>1?$(a).remove():($(a).find("td input").each(function(){$(this).val("")}),$(a).find("td select").each(function(){$(this).val("0")}),$(a).find(".soloFloat").each(function(){$(this).val("0.00")})),CalcularSublinea($("#tablegastos .origLineg"))}function guardaretingreso(){$(".alert-danger").not("#uploaderrors").fadeOut("slow");for(var e="",t="",a=document.getElementById("detalleretenciones").getElementsByTagName("input"),n=0,o=0;o<a.length;o++){var l=a[o].id;if("idret"==l.substr(0,5)){var r=l.substr(5),d=parseFloat(document.getElementById("aux"+r).value);t+=parseFloat(document.getElementById("idret"+r).value)+"||"+document.getElementById("nombreret"+r).value+"||"+parseFloat(document.getElementById("porcentajeret"+r).value)+"||"+parseFloat(document.getElementById("baseciva"+r).value)+"||"+parseFloat(document.getElementById("basesiva"+r).value)+"||"+d+"@@",n+=1}}if(n>0){var i=document.getElementById("numretencion").value,s=document.getElementById("ingresoret").value,u=document.getElementById("sriret").value,c=document.getElementById("serieret").value,m=document.getElementById("caducaret").value;if(e=i+"||"+c+"||"+u+"||"+s+"||"+m+"||"+parseFloat(document.getElementById("totalretencion").value)+"||"+parseFloat(document.getElementById("idasiento").value),""==document.getElementById("idcliente").value)$("#error-content").html("Debe ingresar el cliente para la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0);else if(""==i)$("#error-content").html("Debe ingresar el numero de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0);else if(""==s)$("#error-content").html("Debe ingresar la fecha de ingreso de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0);else if(""==m)$("#error-content").html("Debe ingresar la fecha de caducidad de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0);else{document.getElementById("datosretenciones").value=e,document.getElementById("datosdetalleretenciones").value=t,console.log("entra al submit0");var v=0,p=(g=$("#tablatarjetas .misabonos,#tablafacturas .misabonos")).length;console.log("tamaño"+p),p>0?$(g).each(function(){"0.00"!=$(this).val()&&0!=parseFloat($(this).val())||$(this).parent().parent().remove(),v==p-1&&setTimeout(function(){$("form").not("#fileform").submit()},500),v++}):$("form").not("#fileform").submit()}}else{console.log("entra al submit");var g;v=0,p=(g=$("#tablatarjetas .misabonos,#tablafacturas .misabonos")).length;console.log("tamaño:"+p),p>0?$(g).each(function(){"0.00"!=$(this).val()&&0!=parseFloat($(this).val())||$(this).parent().parent().remove(),v==p-1&&setTimeout(function(){$("form").not("#fileform").submit()},500),v++}):$("form").not("#fileform").submit()}}$(document).ready(function(){LigarAutocomplete(),$("#total_1")&&$("#total_1").val()>0&&(console.log("Entra 1"),CalcularSublinea($("#subsiva_1")))});