function objetoAjax(){var e=!1;try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){e=!1}}return e||"undefined"==typeof XMLHttpRequest||(e=new XMLHttpRequest),e}function quebloque(e){1==e?(document.getElementById("retencion").style.display="none",$("#productos").fadeIn("slow")):2==e&&($("#productos").fadeOut("fast"),$("#retencion").fadeIn("slow"))}function retiva(){var e=document.getElementById("retencioniva").value.split("||");document.getElementById("porcretiva").value=e[1]}function ret(){var e=document.getElementById("reten").value.split("||");document.getElementById("porcret").value=e[1]}function agregaretiva(){for(var e=document.getElementById("numretencion").value,t=document.getElementById("retencioniva").value,a=t.split("||"),n=document.getElementById("baseretiva").value,r=parseFloat(document.getElementById("baseretiva").value),l=parseFloat(document.getElementById("baseretivareal").value),o=0,d=0,i=parseFloat(a[1]),u=document.getElementById("detalleretenciones").getElementsByTagName("input"),s=0;s<u.length;s++){var m=u[s].id;if("idret"==m.substr(0,5)){var c=m.substr(5),v=document.getElementById("idret"+c).value;if(a[0]==v)return alert("No puede ingresar una misma retención."),!1}}""==e?alert("Debe ingresar el numero de la retención."):r>l?(alert("Debe ingresar una base imponible para la retención de : "+l),document.getElementById("baseretiva").value=l):"0"!=t&&"0"!=n&&""!=n&&l>0&&r>0&&(o=r*(i/100),d=l-r,document.getElementById("baseretiva").value=d.toFixed(4),document.getElementById("baseretivareal").value=d.toFixed(4),contm=parseInt(document.getElementById("cuenta").value),contm++,document.getElementById("cuenta").value=contm,myNewRow=document.getElementById("detalleretenciones").insertRow(-1),myNewRow.id=contm,myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="nombreret'+contm+'" id="nombreret'+contm+'" class="form-control" style="width: 100%;height:25px;" value="'+a[2]+'" readonly="readonly"/><input type="hidden" name="idret'+contm+'" id="idret'+contm+'" value="'+a[0]+'"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="porcentajeret'+contm+'" id="porcentajeret'+contm+'" class="form-control" style="width: 100%;text-align: right;height:25px;" value="'+a[1]+'" readonly="readonly"/><input type="hidden" name="aux'+contm+'" id="aux'+contm+'" value="1"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="baseret'+contm+'" id="baseret'+contm+'" class="form-control" style="width: 100%;text-align: right;height:25px;" value="'+r+'" readonly="readonly"/><input type="hidden" name="baseciva'+contm+'" id="baseciva'+contm+'" value="'+r+'"/><input type="hidden" name="basesiva'+contm+'" id="basesiva'+contm+'" value="0"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="valorret'+contm+'" id="valorret'+contm+'" class="form-control" style="width: 100%;text-align: right;height:25px;" value="'+o.toFixed(4)+'" readonly="readonly"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><button type="button" onclick="RemoveRowIva('+contm+');" class="removeLine form-control input-sm fa fa-times"></button></td>'),sacatotal()}function RemoveRowIva(e){var t=0;t=parseFloat(document.getElementById("baseret"+e).value)+parseFloat(document.getElementById("baseretivareal").value),document.getElementById("baseretivareal").value=t,document.getElementById("baseretiva").value=t;var a=document.getElementById(e);a.parentNode.removeChild(a),sacatotal()}function agregaret(e){for(var t=document.getElementById("numretencion").value,a=document.getElementById("reten").value,n=a.split("||"),r=document.getElementById("baseretsubciva").value,l=parseFloat(document.getElementById("baseretsubciva").value),o=parseFloat(document.getElementById("baseretsubcivareal").value),d=document.getElementById("baseretsubsiva").value,i=parseFloat(document.getElementById("baseretsubsiva").value),u=parseFloat(document.getElementById("baseretsubsivareal").value),s=0,m=0,c=parseFloat(n[1]),v=document.getElementById("detalleretenciones").getElementsByTagName("input"),g=0;g<v.length;g++){var y=v[g].id;if("idret"==y.substr(0,5)){var p=y.substr(5),b=document.getElementById("idret"+p).value;if(n[0]==b)return alert("No puede ingresar una misma retención."),!1}}var I=!0;""==t?alert("Debe ingresar el numero de la retención."):1==e&&(l>o?(alert("Debe ingresar una base imponible c/iva para la retención de : "+o),document.getElementById("baseretsubciva").value=o,I=!1):i>u&&(alert("Debe ingresar una base imponible s/iva para la retención de : "+u),document.getElementById("baseretsubsiva").value=u,I=!1)),1==I&&("0"==a||"0"==r&&"0"==d||""==r&&""==d||(s=(l+i)*(c/100),1==e?(o>0||u>0)&&(basequedaci=o-l,basequedasi=u-i,document.getElementById("baseretsubciva").value=basequedaci.toFixed(4),document.getElementById("baseretsubcivareal").value=basequedaci.toFixed(4),document.getElementById("baseretsubsiva").value=basequedasi.toFixed(4),document.getElementById("baseretsubsivareal").value=basequedasi.toFixed(4)):(basequedaci=0,basequedasi=0,(o>0||u>0)&&(document.getElementById("baseretsubciva").value=basequedaci.toFixed(4),document.getElementById("baseretsubcivareal").value=basequedaci.toFixed(4),document.getElementById("baseretsubsiva").value=basequedasi.toFixed(4),document.getElementById("baseretsubsivareal").value=basequedasi.toFixed(4))),m=l+i,contm=n[0],contm++,document.getElementById("cuenta").value=contm,myNewRow=document.getElementById("detalleretenciones").insertRow(-1),myNewRow.id=contm,myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="nombreret'+contm+'" id="nombreret'+contm+'" class="form-control input-sm" style="width: 100%;height:25px;" value="'+n[2]+'" readonly="readonly"/><input type="hidden" name="idret'+contm+'" id="idret'+contm+'" value="'+n[0]+'"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="porcentajeret'+contm+'" id="porcentajeret'+contm+'" class="form-control input-sm" style="width: 100%;text-align: right;height:25px;" value="'+n[1]+'" readonly="readonly"/><input type="hidden" name="aux'+contm+'" id="aux'+contm+'" value="2"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="baseret'+contm+'" id="baseret'+contm+'" class="form-control input-sm" style="width: 100%;text-align: right;height:25px;" value="'+m+'" readonly="readonly"/><input type="hidden" name="baseciva'+contm+'" id="baseciva'+contm+'" value="'+l+'"/><input type="hidden" name="basesiva'+contm+'" id="basesiva'+contm+'" value="'+i+'"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="valorret'+contm+'" id="valorret'+contm+'" class="form-control input-sm" style="width: 100%;text-align: right;height:25px;" value="'+s.toFixed(4)+'" readonly="readonly"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><button type="button" onclick="RemoveRow('+contm+');" class="removeLine form-control input-sm fa fa-times"></button></td>')),sacatotal()}function RemoveRow(e){var t=0,a=0;t=parseFloat(document.getElementById("baseciva"+e).value)+parseFloat(document.getElementById("baseretsubcivareal").value),a=parseFloat(document.getElementById("basesiva"+e).value)+parseFloat(document.getElementById("baseretsubsivareal").value),document.getElementById("baseretsubcivareal").value=t,document.getElementById("baseretsubciva").value=t,document.getElementById("baseretsubsivareal").value=a,document.getElementById("baseretsubsiva").value=a;var n=document.getElementById(e);n.parentNode.removeChild(n),sacatotal()}function sacatotal(){for(var e=document.getElementById("detalleretenciones").getElementsByTagName("input"),t=0,a=0;a<e.length;a++){var n=e[a].id;if("valorret"==n.substr(0,8)){var r=n.substr(8);t+=parseFloat(document.getElementById("valorret"+r).value)}}document.getElementById("totalretencion").value=t.toFixed(4),document.getElementById("paymentCheques").innerHTML=t.toFixed(2),updateForm(t.toFixed(2)),changePaymentCategory("3","Cheques")}function validarretencion(){$(".alert-danger").not("#uploaderrors").fadeOut("slow");for(var e="",t="",a=document.getElementById("detalleretenciones").getElementsByTagName("input"),n=0,r=0;r<a.length;r++){var l=a[r].id;if("idret"==l.substr(0,5)){var o=l.substr(5),d=parseFloat(document.getElementById("aux"+o).value);t+=parseFloat(document.getElementById("idret"+o).value)+"||"+document.getElementById("nombreret"+o).value+"||"+parseFloat(document.getElementById("porcentajeret"+o).value)+"||"+parseFloat(document.getElementById("baseciva"+o).value)+"||"+parseFloat(document.getElementById("basesiva"+o).value)+"||"+d+"@@",n+=1}}if(n>0){var i=document.getElementById("numretencion").value,u=document.getElementById("ingresoret").value,s=document.getElementById("sriret").value,m=document.getElementById("serieret").value,c=document.getElementById("caducaret").value;e=i+"||"+m+"||"+s+"||"+u+"||"+c+"||"+parseFloat(document.getElementById("totalretencion").value),""==i?($("#error-content").html("Debe ingresar el numero de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown()):""==u?($("#error-content").html("Debe ingresar la fecha de ingreso de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown()):""==s?($("#error-content").html("Debe ingresar el numero de autorización de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown()):""==m?($("#error-content").html("Debe ingresar el numero de serie de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown()):""==c?($("#error-content").html("Debe ingresar la fecha de caducidad de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown()):(document.getElementById("datosretencion").value=e,document.getElementById("datosdetalleretencion").value=t,document.getElementById("tieneretencion").value=1,$("#grabareal").click())}else document.getElementById("datosretencion").value="",document.getElementById("datosdetalleretencion").value="",document.getElementById("tieneretencion").value=0,$("#grabareal").click(),console.log("DSD2")}function verbases(e,t,a){var n=parseFloat(document.getElementById("baseretiva").value),r=parseFloat(document.getElementById("baseretsubciva").value),l=parseFloat(document.getElementById("baseretsubsiva").value);n-=e,r-=t,l-=a,document.getElementById("baseretiva").value=n.toFixed(4),document.getElementById("baseretivareal").value=n.toFixed(4),document.getElementById("baseretsubciva").value=r.toFixed(4),document.getElementById("baseretsubcivareal").value=r.toFixed(4),document.getElementById("baseretsubsiva").value=l.toFixed(4),document.getElementById("baseretsubsivareal").value=l.toFixed(4)}function guardaret(){$(".alert-danger").not("#uploaderrors").fadeOut("slow");for(var e="",t="",a=document.getElementById("detalleretenciones").getElementsByTagName("input"),n=0,r=0;r<a.length;r++){var l=a[r].id;if("idret"==l.substr(0,5)){var o=l.substr(5),d=parseFloat(document.getElementById("aux"+o).value);t+=parseFloat(document.getElementById("idret"+o).value)+"||"+document.getElementById("nombreret"+o).value+"||"+parseFloat(document.getElementById("porcentajeret"+o).value)+"||"+parseFloat(document.getElementById("baseciva"+o).value)+"||"+parseFloat(document.getElementById("basesiva"+o).value)+"||"+d+"@@",n+=1}}if(n>0){var i=document.getElementById("numretencion").value,u=document.getElementById("ingresoret").value,s=document.getElementById("sriret").value,m=document.getElementById("serieret").value,c=document.getElementById("caducaret").value;e=i+"||"+m+"||"+s+"||"+u+"||"+c+"||"+parseFloat(document.getElementById("totalretencion").value)+"||0",""==i?($("#error-content").html("Debe ingresar el numero de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown()):""==u?($("#error-content").html("Debe ingresar la fecha de ingreso de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown()):""==c?($("#error-content").html("Debe ingresar la fecha de caducidad de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown()):(document.getElementById("datosretencion").value=e,document.getElementById("datosdetalleretencion").value=t,document.getElementById("tieneretencion").value=1,antesperformPurchase("table"))}else antesperformPurchase("table")}function CalcularSublinea(e){var t=$(e).attr("id").split("_"),a=parseFloat(document.getElementById("ivaaux").value),n=parseFloat($("#subsiva_"+t[1]).val())+parseFloat($("#subciva_"+t[1]).val())*(1+a);$("#total_"+t[1]).val(n.toFixed(2));var r=0;$(".subconiva").each(function(){r+=parseFloat($(this).val())});var l=0;$(".subsiniva").each(function(){l+=parseFloat($(this).val())});var o=0;$(".subconiva").each(function(){o+=parseFloat($(this).val())*a}),$("#firstSubConIva,#finalSubConIva").val(r.toFixed(4)),$("#firstSubSinIva,#finalSubSinIva").val(l.toFixed(4)),$("#finalIVA").val(o.toFixed(4)),MisTotales()}function AddLineGasto(){for(var e=$("#tablegastos tr"),t=1,a=0;a<e.length;a++){var n=e[a].id.split("_")[1];parseInt(n)>t&&(t=parseInt(n))}var r=parseInt(t)+1,l=$(".origLineg").clone().find("input").val("0.00").end().insertAfter("#tablegastos tr:last");l.removeAttr("class"),l.attr("id","fila_"+r),l.find(".cuentas").attr("id","cuenta_"+r),l.find(".idcuentas").attr("id","idcuenta_"+r),$("#cuenta_"+r+",#idcuenta_"+r).val(""),l.find(".subconiva").attr("id","subciva_"+r),l.find(".subsiniva").attr("id","subsiva_"+r),l.find(".totales").attr("id","total_"+r),l.find(".eliminargasto").attr("id","eliminar_"+r),l.find(".selcentroc").attr("id","centrocosto_"+r),LigarAutocomplete()}function LigarAutocomplete(){$(".cuentas").each(function(){$(this).autocomplete({source:"subpages/contabilidad/ajaxplan.php",select:function(e,t){console.log(t.item.id);var a=$(this).attr("id").split("_");$("#idcuenta_"+a[1]).val(t.item.id),$("#subciva_"+a[1]).focus(),$("#subciva_"+a[1]).select()}})})}function MisTotales(){var e=parseFloat($("#firstSubSinIva").val()),t=parseFloat($("#firstDiscount").val()),a=parseFloat($("#secondDiscount").val()),n=parseFloat($("#firstSubConIva").val()),r=parseFloat($("#ice").val()),l=parseFloat($("#impVerde").val()),o=parseFloat($("#finalIVA").val());console.log(r),console.log(l),$("#finalTotal").html(parseFloat(n-a+(e-t)+o+r+l).toFixed(2))}function EliminarFilaGasto(e){var t=$(e).attr("id").split("_"),a=$("#fila_"+t[1]);parseInt(t[1])>1?$(a).remove():($(a).find("td input").each(function(){$(this).val("")}),$(a).find("td select").each(function(){$(this).val("0")})),CalcularSublinea($("#tablegastos .origLineg"))}function guardaretingreso(){$(".alert-danger").not("#uploaderrors").fadeOut("slow");for(var e="",t="",a=document.getElementById("detalleretenciones").getElementsByTagName("input"),n=0,r=0;r<a.length;r++){var l=a[r].id;if("idret"==l.substr(0,5)){var o=l.substr(5),d=parseFloat(document.getElementById("aux"+o).value);t+=parseFloat(document.getElementById("idret"+o).value)+"||"+document.getElementById("nombreret"+o).value+"||"+parseFloat(document.getElementById("porcentajeret"+o).value)+"||"+parseFloat(document.getElementById("baseciva"+o).value)+"||"+parseFloat(document.getElementById("basesiva"+o).value)+"||"+d+"@@",n+=1}}if(n>0){var i=document.getElementById("numretencion").value,u=document.getElementById("ingresoret").value,s=document.getElementById("sriret").value,m=document.getElementById("serieret").value,c=document.getElementById("caducaret").value;e=i+"||"+m+"||"+s+"||"+u+"||"+c+"||"+parseFloat(document.getElementById("totalretencion").value)+"||"+parseFloat(document.getElementById("idasiento").value),""==document.getElementById("idcliente").value?($("#error-content").html("Debe ingresar el cliente en cartera de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown()):""==i?($("#error-content").html("Debe ingresar el numero de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown()):""==u?($("#error-content").html("Debe ingresar la fecha de ingreso de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown()):""==c?($("#error-content").html("Debe ingresar la fecha de caducidad de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown()):(document.getElementById("datosretenciones").value=e,document.getElementById("datosdetalleretenciones").value=t,setTimeout(function(){$("form").not("#fileform").submit()},2e3))}else $("form").not("#fileform").submit()}$(document).ready(function(){LigarAutocomplete(),$("#total_1")&&$("#total_1").val()>0&&(console.log("Entra"),CalcularSublinea($("#subsiva_1")))});