function objetoAjax(){var e=!1;try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){e=!1}}return e||"undefined"==typeof XMLHttpRequest||(e=new XMLHttpRequest),e}function quebloque(e){console.log(e),1==e?(document.getElementById("retencion").style.display="none",$("#productos").fadeIn("slow"),$("#poprelacionados").css("display","none")):2==e&&($("#productos").fadeOut("fast"),$("#retencion").fadeIn("slow"),$("#poprelacionados").css("display","none"))}function retiva(){var e=document.getElementById("retencioniva").value.split("||");document.getElementById("porcretiva").value=e[1]}function ret(){var e=document.getElementById("reten").value.split("||");document.getElementById("porcret").value=e[1]}function agregaretiva(e){for(var t=document.getElementById("numretencion").value,n=document.getElementById("retencioniva").value,l=n.split("||"),r=document.getElementById("baseretiva").value,o=parseFloat(document.getElementById("baseretiva").value),d=parseFloat(document.getElementById("baseretivareal").value),i=0,s=0,u=parseFloat(l[1]),c=document.getElementById("detalleretenciones").getElementsByTagName("input"),m=0;m<c.length;m++){var v=c[m].id;if("idret"==v.substr(0,5)){e=v.substr(5);var p=document.getElementById("idret"+e).value;if(l[0]==p)return alert("No puede ingresar una misma retención."),!1}}if(0==e&&(d=o),""==t?alert("Debe ingresar el numero de la retención."):1==e&&o>d&&(alert("Debe ingresar una base imponible para la retención de : "+d),document.getElementById("baseretiva").value=d),"0"!=n&&"0"!=r&&""!=r&&d>0&&o>0){i=o*(u/100),s=d-o,document.getElementById("baseretiva").value=s.toFixed(4),document.getElementById("baseretivareal").value=s.toFixed(4),contm=1e4+l[0],document.getElementById("cuenta").value=contm,myNewRow=document.getElementById("detalleretenciones").insertRow(-1),myNewRow.id="r_"+contm,myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="nombreret'+contm+'" id="nombreret'+contm+'" class="form-control" style="width: 100%;height:25px;" value="'+l[2]+'" readonly="readonly"/><input type="hidden" name="idret'+contm+'" id="idret'+contm+'" value="'+l[0]+'"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="porcentajeret'+contm+'" id="porcentajeret'+contm+'" class="form-control" style="width: 100%;text-align: right;height:25px;" value="'+l[1]+'" readonly="readonly"/><input type="hidden" name="aux'+contm+'" id="aux'+contm+'" value="1"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="baseret'+contm+'" id="baseret'+contm+'" class="form-control" style="width: 100%;text-align: right;height:25px;" value="'+o+'" readonly="readonly"/><input type="hidden" name="baseciva'+contm+'" id="baseciva'+contm+'" value="'+o+'"/><input type="hidden" name="basesiva'+contm+'" id="basesiva'+contm+'" value="0"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="valorret'+contm+'" id="valorret'+contm+'" class="form-control" style="width: 100%;text-align: right;height:25px;" value="'+(Math.round(100*i)/100).toFixed(2)+'" readonly="readonly"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><button type="button" onclick="RemoveRowIva('+contm+');" class="removeLine form-control input-sm fa fa-times"></button></td>';var g=document.getElementById("totaldebe").value-i;document.getElementById("totaldebe").value=(Math.round(100*g)/100).toFixed(2),separadorDecimalesInicial=".",separadorDecimales=".",separadorMiles=",";var b=Math.round(100*g/100).toFixed(2);document.getElementById("totaldebe1").value=function(e){var t="";for(e=""+e,partes=e.split(separadorDecimalesInicial),entero=partes[0],partes.length>1&&(decimal=partes[1]),cifras=entero.length,cifras2=cifras,a=0;a<cifras;a++)cifras2-=1,t+=entero.charAt(a),cifras2%3==0&&0!=cifras2&&(t+=separadorMiles);return partes.length>1&&(t+=separadorDecimales+decimal),t}(b)}sacatotal()}function RemoveRowIva(e){var t=0;t=parseFloat(document.getElementById("baseret"+e).value)+parseFloat(document.getElementById("baseretivareal").value),document.getElementById("baseretivareal").value=t,document.getElementById("baseretiva").value=t;var a=parseFloat(document.getElementById("valorret"+e).value),n=parseFloat(document.getElementById("totaldebe").value)+a;document.getElementById("totaldebe").value=(Math.round(100*n)/100).toFixed(2),document.getElementById("totaldebe1").value=(Math.round(100*n)/100).toFixed(2);var l=document.getElementById("r_"+e);l.parentNode.removeChild(l),sacatotal()}function agregaret(e){var t=document.getElementById("numretencion").value,n=document.getElementById("reten").value,l=n.split("||"),r=document.getElementById("baseretsubciva").value,o=parseFloat(document.getElementById("baseretsubciva").value),d=parseFloat(document.getElementById("baseretsubcivareal").value),i=document.getElementById("baseretsubsiva").value,s=parseFloat(document.getElementById("baseretsubsiva").value),u=parseFloat(document.getElementById("baseretsubsivareal").value),c=0,m=0,v=parseFloat(l[1]),p=document.getElementById("detalleretenciones").getElementsByTagName("input");console.log(p);for(var g=0;g<p.length;g++){var b=p[g].id;if("idret"==b.substr(0,5)){var y=b.substr(5),I=document.getElementById("idret"+y).value;if(l[0]==I)return alert("No puede ingresar una misma retención."),!1}}var f=!0;if(""==t?alert("Debe ingresar el numero de la retención."):1==e&&(o>d?(alert("Debe ingresar una base imponible c/iva para la retención de : "+d),document.getElementById("baseretsubciva").value=d,f=!1):s>u&&(alert("Debe ingresar una base imponible s/iva para la retención de : "+u),document.getElementById("baseretsubsiva").value=u,f=!1)),1==f&&!("0"==n||"0"==r&&"0"==i||""==r&&""==i)){if(c=(o+s)*(v/100),status){var E=document.getElementById("totaldebe").value;E-=(Math.round(100*c)/100).toFixed(2),document.getElementById("totaldebe").value=E,document.getElementById("totaldebe1").value=E}1==e?(d>0||u>0)&&(basequedaci=d-o,basequedasi=u-s,document.getElementById("baseretsubciva").value=basequedaci.toFixed(4),document.getElementById("baseretsubcivareal").value=basequedaci.toFixed(4),document.getElementById("baseretsubsiva").value=basequedasi.toFixed(4),document.getElementById("baseretsubsivareal").value=basequedasi.toFixed(4)):(basequedaci=0,basequedasi=0,(d>0||u>0)&&(document.getElementById("baseretsubciva").value=basequedaci.toFixed(4),document.getElementById("baseretsubcivareal").value=basequedaci.toFixed(4),document.getElementById("baseretsubsiva").value=basequedasi.toFixed(4),document.getElementById("baseretsubsivareal").value=basequedasi.toFixed(4))),m=o+s,contm=1e4+l[0],document.getElementById("cuenta").value=contm,myNewRow=document.getElementById("detalleretenciones").insertRow(-1),myNewRow.id="r_"+contm,myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="nombreret'+contm+'" id="nombreret'+contm+'" class="form-control input-sm" style="width: 100%;height:25px;" value="'+l[2]+'" readonly="readonly"/><input type="hidden" name="idret'+contm+'" id="idret'+contm+'" value="'+l[0]+'"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="porcentajeret'+contm+'" id="porcentajeret'+contm+'" class="form-control input-sm" style="width: 100%;text-align: right;height:25px;" value="'+l[1]+'" readonly="readonly"/><input type="hidden" name="aux'+contm+'" id="aux'+contm+'" value="2"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="baseret'+contm+'" id="baseret'+contm+'" class="form-control input-sm" style="width: 100%;text-align: right;height:25px;" value="'+m+'" readonly="readonly"/><input type="hidden" name="baseciva'+contm+'" id="baseciva'+contm+'" value="'+o+'"/><input type="hidden" name="basesiva'+contm+'" id="basesiva'+contm+'" value="'+s+'"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><input type="text" name="valorret'+contm+'" id="valorret'+contm+'" class="form-control input-sm" style="width: 100%;text-align: right;height:25px;" value="'+(Math.round(100*c)/100).toFixed(2)+'" readonly="readonly"/></td>',myNewCell=myNewRow.insertCell(-1),myNewCell.innerHTML='<td><button type="button" onclick="RemoveRow('+contm+');" class="removeLine form-control input-sm fa fa-times"></button></td>';var B=document.getElementById("totaldebe").value-c;document.getElementById("totaldebe").value=(Math.round(100*B)/100).toFixed(2),separadorDecimalesInicial=".",separadorDecimales=".",separadorMiles=",";var $=Math.round(100*B/100).toFixed(2);document.getElementById("totaldebe1").value=function(e){var t="";for(e=""+e,partes=e.split(separadorDecimalesInicial),entero=partes[0],partes.length>1&&(decimal=partes[1]),cifras=entero.length,cifras2=cifras,a=0;a<cifras;a++)cifras2-=1,t+=entero.charAt(a),cifras2%3==0&&0!=cifras2&&(t+=separadorMiles);return partes.length>1&&(t+=separadorDecimales+decimal),t}($)}sacatotal()}function RemoveRow(e){var t=0,a=0;t=parseFloat(document.getElementById("baseciva"+e).value)+parseFloat(document.getElementById("baseretsubcivareal").value),a=parseFloat(document.getElementById("basesiva"+e).value)+parseFloat(document.getElementById("baseretsubsivareal").value),document.getElementById("baseretsubcivareal").value=t,document.getElementById("baseretsubciva").value=t,document.getElementById("baseretsubsivareal").value=a,document.getElementById("baseretsubsiva").value=a;var n=parseFloat(document.getElementById("valorret"+e).value),l=parseFloat(document.getElementById("totaldebe").value)+n;document.getElementById("totaldebe").value=(Math.round(100*l)/100).toFixed(2),document.getElementById("totaldebe1").value=(Math.round(100*l)/100).toFixed(2);var r=$("#r_"+e);console.log(r),r.remove(),sacatotal()}function sacatotal(){for(var e=document.getElementById("detalleretenciones").getElementsByTagName("input"),t=0,a=0;a<e.length;a++){var n=e[a].id;if("valorret"==n.substr(0,8)){var l=n.substr(8);t+=parseFloat(document.getElementById("valorret"+l).value)}}document.getElementById("totalretencion").value=t.toFixed(2)}function validarretencion(){$(".alert-danger").not("#uploaderrors").fadeOut("slow");for(var e="",t="",a=document.getElementById("detalleretenciones").getElementsByTagName("input"),n=0,l=0;l<a.length;l++){var r=a[l].id;if("idret"==r.substr(0,5)){var o=r.substr(5),d=parseFloat(document.getElementById("aux"+o).value);t+=parseFloat(document.getElementById("idret"+o).value)+"||"+document.getElementById("nombreret"+o).value+"||"+parseFloat(document.getElementById("porcentajeret"+o).value)+"||"+parseFloat(document.getElementById("baseciva"+o).value)+"||"+parseFloat(document.getElementById("basesiva"+o).value)+"||"+d+"@@",n+=1}}if(n>0){var i=document.getElementById("numretencion").value,s=document.getElementById("ingresoret").value,u=document.getElementById("sriret").value,c=document.getElementById("serieret").value,m=document.getElementById("caducaret").value;e=i+"||"+c+"||"+u+"||"+s+"||"+m+"||"+parseFloat(document.getElementById("totalretencion").value),""==i?($("#error-content").html("Debe ingresar el numero de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0)):""==s?($("#error-content").html("Debe ingresar la fecha de ingreso de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0)):""==u?($("#error-content").html("Debe ingresar el numero de autorización de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0)):""==c?($("#error-content").html("Debe ingresar el numero de serie de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0)):""==m?($("#error-content").html("Debe ingresar la fecha de caducidad de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0)):(document.getElementById("datosretencion").value=e,document.getElementById("datosdetalleretencion").value=t,document.getElementById("tieneretencion").value=1,QuitarVectores())}else document.getElementById("datosretencion").value="",document.getElementById("datosdetalleretencion").value="",document.getElementById("tieneretencion").value=0,QuitarVectores(),console.log("DSD2")}function verbases(e,t,a){var n=parseFloat(document.getElementById("baseretiva").value),l=parseFloat(document.getElementById("baseretsubciva").value),r=parseFloat(document.getElementById("baseretsubsiva").value);n-=e,l-=t,r-=a,document.getElementById("baseretiva").value=n.toFixed(4),document.getElementById("baseretivareal").value=n.toFixed(4),document.getElementById("baseretsubciva").value=l.toFixed(4),document.getElementById("baseretsubcivareal").value=l.toFixed(4),document.getElementById("baseretsubsiva").value=r.toFixed(4),document.getElementById("baseretsubsivareal").value=r.toFixed(4)}function guardaret(e,t){$(".alert-danger").not("#uploaderrors").fadeOut("slow");for(var a="",n="",l=document.getElementById("detalleretenciones").getElementsByTagName("input"),r=0,o=0;o<l.length;o++){var d=l[o].id;if("idret"==d.substr(0,5)){var i=d.substr(5),s=parseFloat(document.getElementById("aux"+i).value);n+=parseFloat(document.getElementById("idret"+i).value)+"||"+document.getElementById("nombreret"+i).value+"||"+parseFloat(document.getElementById("porcentajeret"+i).value)+"||"+parseFloat(document.getElementById("baseciva"+i).value)+"||"+parseFloat(document.getElementById("basesiva"+i).value)+"||"+s+"@@",r+=1}}if(r>0){var u=document.getElementById("numretencion").value,c=document.getElementById("ingresoret").value,m=document.getElementById("sriret").value,v=document.getElementById("serieret").value,p=document.getElementById("caducaret").value;if(a=u+"||"+v+"||"+m+"||"+c+"||"+p+"||"+parseFloat(document.getElementById("totalretencion").value)+"||"+parseFloat(document.getElementById("idasiento").value),""==u)$("#error-content").html("Debe ingresar el numero de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0);else if(""==c)$("#error-content").html("Debe ingresar la fecha de ingreso de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0);else if(""==p)$("#error-content").html("Debe ingresar la fecha de caducidad de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0);else{document.getElementById("datosretencion").value=a,document.getElementById("datosdetalleretencion").value=n,document.getElementById("tieneretencion").value=1;var g=objetoAjax();g.open("POST","/contabilidad/ajax/retenciones.php",!0),g.onreadystatechange=function(){if(4==g.readyState){var e=g.responseText;console.log(e),location.reload(!0)}},g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.send("&datosretencion="+a+"&datosdetalleretencion="+n+"&id="+e+"&idcli="+t+"&tieneretencion=1&que=1")}}}function CalcularSublinea(e){var t=$(e).attr("id").split("_"),a=parseFloat(document.getElementById("ivaaux").value);if(1==$("#multiple_iva").val()){var n=$("#prodImpg_"+t[1]),l=$(n).find("option:selected");a=parseFloat(l.attr("data-value")),$("#prodIDImpg_"+t[1]).val(a)}var r=0;$(".subconiva").each(function(){r+=parseFloat($(this).val())});var o=0;$(".subsiniva").each(function(){o+=parseFloat($(this).val())});var d=0;d=(r-=parseFloat($("#secondDiscount").val()))*a;var i=0;0==$("#multiple_iva").val()?$(".subceroiva").each(function(){i+=parseFloat($(this).val())}):$(".prodImpg").each(function(){var e=$(this).find("option:selected"),t=parseFloat(e.attr("data-value")),a=$(this).attr("id").split("_");0==t&$(this).val()>0&&(i+=parseFloat($("#subciva_"+a[1]).val()))}),i>0&&1==$("#multiple_iva").val()&&(r=0);var s=0;$(".subceroiva").length>0&&(s=parseFloat($("#subceroiva_"+t[1]).val()));var u=parseFloat($("#subsiva_"+t[1]).val())+parseFloat($("#subciva_"+t[1]).val())*(1+a)+s;console.log(u),$("#total_"+t[1]).val(u.toFixed(2)),$("#firstSubConIva").val(r.toFixed(4)),$("#firstSubSinIva").val(o.toFixed(4)),$("#firstSubCeroIva").val(i.toFixed(4)),$("#finalIVA").val(d.toFixed(4)),CalculateCosts($("#firstDiscount")),CalculateCosts($("#secondDiscount")),CalculateCosts($("#firstDiscountCero")),MisTotales()}function AddLineGasto(){for(var e=$("#tablegastos tr"),t=1,a=0;a<e.length;a++){var n=e[a].id.split("_")[1];parseInt(n)>t&&(t=parseInt(n))}var l=parseInt(t)+1,r=$(".origLineg").clone().find("input").val("0.00").end().insertAfter("#tablegastos tr:last");r.removeAttr("class"),r.attr("id","fila_"+l),r.find(".cuentas").attr("id","cuenta_"+l),r.find(".idcuentas").attr("id","idcuenta_"+l),$("#cuenta_"+l+",#idcuenta_"+l).val(""),r.find(".subconiva").attr("id","subciva_"+l),r.find(".subsiniva").attr("id","subsiva_"+l),r.find(".subceroiva").attr("id","subceroiva_"+l),r.find(".totales").attr("id","total_"+l),r.find(".eliminargasto").attr("id","eliminar_"+l),r.find(".selcentroc").attr("id","centrocosto_"+l),r.find(".prodIDImpg").attr("id","prodIDImpg_"+l),r.find(".prodImpg").attr("id","prodImpg_"+l),$("#centrocosto_"+l).val($("#centrocosto_1").val()),LigarAutocomplete()}function LigarAutocomplete(){$(".cuentas").each(function(){$(this).autocomplete({source:"subpages/contabilidad/ajaxplannew.php",select:function(e,t){console.log(t.item.id);var a=$(this).attr("id").split("_");$("#idcuenta_"+a[1]).val(t.item.id),$("#subciva_"+a[1]).focus(),$("#subciva_"+a[1]).select()}})})}function MisTotales(){var e=parseFloat($("#firstSubSinIva").val()),t=parseFloat($("#firstDiscount").val()),a=parseFloat($("#secondDiscount").val()),n=parseFloat($("#firstSubConIva").val()),l=parseFloat($("#firstSubCeroIva").val()),r=parseFloat($("#firstDiscountCero").val()),o=parseFloat($("#ice").val()),d=parseFloat($("#impVerde").val()),i=parseFloat($("#finalIVA").val()),s=""==$("#otros").val()?0:parseFloat($("#otros").val());console.log(o),console.log(n-a+"entra 0"),$("#finalTotal").html(parseFloat(n-a+(e-t)+parseFloat(l-r)+i+o+d+s).toFixed(2))}function EliminarFilaGasto(e){var t=$(e).attr("id").split("_"),a=$("#fila_"+t[1]);parseInt(t[1])>1?$(a).remove():($(a).find("td input").each(function(){$(this).val("")}),$(a).find("td select").each(function(){$(this).val("0")}),$(a).find(".soloFloat").each(function(){$(this).val("0.00")})),CalcularSublinea($("#tablegastos .origLineg"))}function guardaretingreso(){$(".alert-danger").not("#uploaderrors").fadeOut("slow");for(var e="",t="",a=document.getElementById("detalleretenciones").getElementsByTagName("input"),n=0,l=0;l<a.length;l++){var r=a[l].id;if("idret"==r.substr(0,5)){var o=r.substr(5),d=parseFloat(document.getElementById("aux"+o).value);t+=parseFloat(document.getElementById("idret"+o).value)+"||"+document.getElementById("nombreret"+o).value+"||"+parseFloat(document.getElementById("porcentajeret"+o).value)+"||"+parseFloat(document.getElementById("baseciva"+o).value)+"||"+parseFloat(document.getElementById("basesiva"+o).value)+"||"+d+"@@",n+=1}}if(n>0){var i=document.getElementById("numretencion").value,s=document.getElementById("ingresoret").value,u=document.getElementById("sriret").value,c=document.getElementById("serieret").value,m=document.getElementById("caducaret").value;if(e=i+"||"+c+"||"+u+"||"+s+"||"+m+"||"+parseFloat(document.getElementById("totalretencion").value)+"||"+parseFloat(document.getElementById("idasiento").value),""==document.getElementById("idcliente").value)$("#error-content").html("Debe ingresar el cliente para la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0);else if(""==i)$("#error-content").html("Debe ingresar el numero de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0);else if(""==s)$("#error-content").html("Debe ingresar la fecha de ingreso de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0);else if(""==m)$("#error-content").html("Debe ingresar la fecha de caducidad de la retención para poder guardar."),$(".alert-danger").not("#uploaderrors").slideDown(),$("#btnguarda").prop("disabled",!1),$("#content").scrollTop(0);else{document.getElementById("datosretenciones").value=e,document.getElementById("datosdetalleretenciones").value=t,console.log("entra al submit0");var v=0,p=(g=$("#tablatarjetas .misabonos,#tablafacturas .misabonos")).length;console.log("tamaño"+p),p>0?$(g).each(function(){"0.00"!=$(this).val()&&0!=parseFloat($(this).val())||$(this).parent().parent().remove(),v==p-1&&setTimeout(function(){$("form").not("#fileform").submit()},500),v++}):$("form").not("#fileform").submit()}}else{console.log("entra al submit");var g;v=0,p=(g=$("#tablatarjetas .misabonos,#tablafacturas .misabonos")).length;console.log("tamaño:"+p),p>0?$(g).each(function(){"0.00"!=$(this).val()&&0!=parseFloat($(this).val())||$(this).parent().parent().remove(),v==p-1&&setTimeout(function(){$("form").not("#fileform").submit()},500),v++}):$("form").not("#fileform").submit()}}$(document).ready(function(){LigarAutocomplete(),$("#total_1")&&$("#total_1").val()>0&&(console.log("Entra 1"),CalcularSublinea($("#subsiva_1")))});